{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê²Œì„ ë¦¬ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="{% static 'cardgame/style.css' %}" />
  </head>
  <body>
    <div class="window-frame">
      <div class="title-bar">
        <span class="title-text">Pirogramming Card Game</span>
      </div>

      <div class="window-body">
        <div class="game-list-wrapper">
          <h2 class="current-player">
            í˜„ì¬ í”Œë ˆì´ì–´ : {{ current_user.username }}
          </h2>

          <div class="game-history-list table-layout">
            <div class="game-list-header table-row">
              <div class="game-list-cell table-cell">ê²Œì„ ì •ë³´</div>
              <div class="game-list-cell table-cell">ê²Œì„ ìƒíƒœ</div>
              <div class="game-list-cell table-cell">ë²„íŠ¼</div>
            </div>

            {% for game in games %}
            <div class="game-item table-row">
              <div class="game-info game-list-cell table-cell">
                {{ game.id }} - {{ game.attacker.username }} VS {{
                game.defender.username }}
              </div>
              <div class="game-status game-list-cell table-cell">
                {% if game.result == 'win' %} ê²°ê³¼: ğŸ‘‘ìŠ¹ë¦¬ğŸ‘‘ {% elif game.result
                == 'lose' %} ê²°ê³¼: ğŸ˜­íŒ¨ë°°ğŸ˜­ {% else %} ì§„í–‰ ì¤‘ ... {% endif %}
              </div>
              <div class="game-buttons game-list-cell table-cell">
                <a href="{% url 'game_detail' game.id %}" class="btn"
                  >ê²Œì„ì •ë³´</a
                >

                {% if game.result == None %} {# game.resultê°€ ì—†ì„ ë•Œ (ê²Œì„ ì§„í–‰ ì¤‘) ë²„íŠ¼ í‘œì‹œ #}
                  {% if game.defender == current_user %} {# í˜„ì¬ ì‚¬ìš©ìê°€ ë°©ì–´ìì¼ ë•Œë§Œ CounterAttack ë²„íŠ¼ í‘œì‹œ #}
                  <a href="{% url 'game_counterattack' game.id %}" class="btn"
                    >CounterAttack</a
                  >
                  {% endif %} {# game.defender == current_user ì¡°ê±´ ì¢…ë£Œ #}

                  {% if game.attacker == current_user %} {# í˜„ì¬ ì‚¬ìš©ìê°€ ê³µê²©ìì¼ ë•Œë§Œ ê²Œì„ ì·¨ì†Œ ë²„íŠ¼ í‘œì‹œ #}
                  <form
                    method="POST"
                    action="{% url 'cancel_game' game.id %}" {# 'game_cancel'ì„ 'cancel_game'ìœ¼ë¡œ ìˆ˜ì • #}
                    class="cancel-form"
                  >
                    {% csrf_token %}
                    <button type="submit" class="btn cancel-btn">ê²Œì„ì·¨ì†Œ</button>
                  </form>
                  {% endif %} {# game.attacker == current_user ì¡°ê±´ ì¢…ë£Œ #}
                {% endif %} {# game.result == None ì¡°ê±´ ì¢…ë£Œ #}
              </div>
            </div>
            {% empty %}
            <div class="table-row">
              <div class="table-cell" colspan="3" style="text-align: center">
                í˜„ì¬ ê¸°ë¡ëœ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
